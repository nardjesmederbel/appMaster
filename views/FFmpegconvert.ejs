<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Page menu</title>

  <link rel="stylesheet" href="/stylesheets/style.css">
  <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
<body class="flex bg-gray-100 min-h-screen">
  <aside class="hidden sm:flex sm:flex-col">
    <a href="#" class="inline-flex items-center justify-center h-20 w-20 bg-purple-600 hover:bg-purple-500 focus:bg-purple-500">
      <span class="h-18 w-18  sm:ml-1 mr-2 bg-gray-100 rounded-full overflow-hidden">
        <img src="/images/ffmpeg.png" alt="user profile photo" class="h-full w-full object-cover">
      </span>
    
    </a>
    <div class="flex-grow flex flex-col justify-between text-gray-500 bg-gray-800">
      <div class="inline-flex items-center justify-center h-20 w-20 border-t border-gray-700">
          </div>
    </div>
  </aside>
  <div class="flex-grow text-gray-800">
    <header class="flex items-center h-20 px-6 sm:px-10 bg-white">
      <button class="block sm:hidden relative flex-shrink-0 p-2 mr-2 text-gray-600 hover:bg-gray-100 hover:text-gray-800 focus:bg-gray-100 focus:text-gray-800 rounded-full">
        <span class="sr-only">Menu</span>
          <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
      </button>
      <div class="flex flex-shrink-0 items-center ml-auto">
        <button class="inline-flex items-center p-2 hover:bg-gray-100 focus:bg-gray-100 rounded-lg">
          <span class="sr-only">User Menu</span>
          <div class="hidden md:flex md:flex-col md:items-end md:leading-tight">
            <span class="font-semibold">IPCameraFFmpeg</span>
            <span class="font-thin"><%= user %></span>
        
          </div>
          <span class="h-12 w-12 ml-2 sm:ml-3 mr-2 bg-gray-100 rounded-full overflow-hidden">
            <img src="/images/insc.png" alt="user profile photo" class="h-full w-full object-cover">
          </span>
          <svg aria-hidden="true" viewBox="0 0 20 20" fill="currentColor" class="hidden sm:block h-6 w-6 text-gray-300">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg> 
        </button>
        <div class="flex border-l pl-3 ml-3 space-x-1">
          <button class="flex-1 relative p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 focus:bg-gray-100 focus:text-gray-600 rounded-full">
            <span class="sr-only">Notifications</span>
            <span class="absolute top-0 right-0 h-2 w-2 mt-1 mr-2 bg-red-500 rounded-full"></span>
            <span class="absolute top-0 right-0 h-2 w-2 mt-1 mr-2 bg-red-500 rounded-full animate-ping"></span>
            <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
          </button>
          <form action="/getmenu" method="post" class="flex-1"><input type="text" name="user"  value="<%= user %>" hidden>
            <button class="relative p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 focus:bg-gray-100 focus:text-gray-600 rounded-full">
            <span class="sr-only">Log out</span>
            <svg aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-6 w-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
           </svg>
          </button></form> 
        </div>
      </div>
    </header>
       <main class="flex-1 items-left mt-2 w-full h-fit px-1 ml-20">
        <div onclick="clearMSG();" class="container w-full md:w-5/5 bg-slate-400 mt-10">
          <div id="message" class="container w-full md:w-5/5 bg-slate-400 mt-10 text-red-400">

          </div>
      <!-- component -->
      
       <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 flex flex-col my-2">
      <div class="flex-row mt-6">
        <form  enctype="multipart/form-data"  id="uploadForm" >
          <div class="-mx-3 md:flex mb-6">
            <div class="md:w-1/2 px-3">
              <label for="formFile" class="form-label block  tracking-wide text-grey-darker text-xs font-normal mb-2">Select Video</label>
              <input style="width: 350px;" class="form-control appearance-none block w-full bg-grey-lighter text-grey-darker border border-grey-lighter rounded py-3 px-4" type="file" id="videoFile" onchange="clearall();" name="videoFile"  accept="video/*" >
           </div>
            <div  class="md:w-1/2 px-3 mb-6 md:mb-0">
              <label class="block  tracking-wide text-grey-darker text-xs font-normal mb-2" for="grid-first-name">
                  Output Format</label>
               <select  id="format" name="videoFormat" class="appearance-none block w-full bg-red-100 text-grey-darker border border-green rounded py-3 px-4 mb-3">
                <option value="avi">AVI</option>
                <option selected value="mp4">MP4</option>
                <option value="flv">FLV</option>
                <option value="3gp">3GP</option>
                <option value="mkv">mkv</option>
               <option value="mov">MOV</option>
                <option value="mpd">MPD</option>
                <option value="h264">H264</option>
                <option value="h265">h265</option>
                <option value="yuv">yuv</option>
                </select>
               </div>
               <div  class="md:w-1/2 px-3 mb-6 md:mb-0">
                <label class="block  tracking-wide text-grey-darker text-xs font-normal mb-2" for="grid-first-name">
                    Width@Height Video</label>
                 <select  id="widthvideo" name="WidthVideo" class="appearance-none block w-full bg-green-50 text-grey-darker border border-green rounded py-3 px-4 mb-3">
                  <option value="256x144">256x144</option>
                  <option value="512x288">512x288</option>
                  <option value="720x480 ">720x480</option>
                  <option selected value="1280x720">1280x720</option>
                  <option value="1920x1080">1920x1080</option>
                  <option value="3840x2160">3840x2160</option>
                  <option value="7680x4320">7680x4320</option>
                  </select>
                 </div>
           <div class="md:w-1/2 px-3">
              <label class="block  tracking-wide text-grey-darker text-xs font-normal mb-2" for="grid-last-name">
                  Scale Video 
              </label>
              <select  id="format" name="bitrate" class="appearance-none block w-full bg-blue-50 text-grey-darker border border-green rounded py-3 px-4 mb-3">
                     <option  value="200k">200k</option>
                     <option value="350k">350k</option>
                     <option selected value="600k">600k</option>
                     <option value="2350k">2350k</option>
                     <option value="3000k">3000k</option>
                     <option value="3850k">3850k</option>
                     <option value="4300k">4300k</option>
                     <option value="15000k">15000k</option>
                     </select>
                </div>
            </div>
        <div class="-mx-3 md:flex mb-6">
            <div   class="md:w-1/2 px-3">
              <label for="formFile" class="form-label block  tracking-wide text-grey-darker text-xs font-normal mb-2">Nom Video Output</label>
              <input style="width: 350px;" class="form-control appearance-none block w-full bg-grey-lighter text-grey-darker border border-grey-lighter rounded py-3 px-4" type="text" name="NomVideoOutput" id="NomVideoOutput">
           </div>
            <div class="md:w-1/2 px-3">
              <label class="block tracking-wide text-grey-darker text-xs font-normal mb-2">
                  Progrission Video  
              </label>
              <div class="form-control appearance-none block w-full bg-grey-lighter text-grey-darker border border-grey-lighter rounded py-3 px-4">
                <div class="w-full bg-gray-200 rounded-full dark:bg-gray-700 pt-0">
                  <div id="progressbar" class="bg-blue-600 text-xs font-medium text-blue-100 text-center p-3 leading-none rounded-full" style="width: 0%;height: 25px;padding-top: 6px;"></div>
                 </div>
            </div>
            </div>
            <div class="md:w-1/2 px-3 mt-6">
              <button type="submit"  class="form-control appearance-none block w-full bg-grey-lighter text-grey-darker  text-center mt-0.5 px-2 py-3 text-purple-600 hover:text-purple-700 focus:text-purple-700 hover:bg-purple-100 focus:bg-purple-100 border border-purple-600 rounded-md mb-3">
                   Convert Video
              </button>
           </div>
           <div class="md:w-1/2 px-3 mt-6">
            <a href="" id="dowloadurl" style="display: none;"   download  class="form-control appearance-none block w-full bg-grey-lighter text-grey-darker  text-center mt-0.5 px-2 py-3 text-yellow-600 hover:text-yellow-700 focus:text-yellow-700 hover:bg-yellow-100 focus:bg-yellow-100 border border-yellow-600 rounded-md mb-3 no-underline">
              Download File Vedio  
            </a>
         </div>
        </div>
         </form>
       </div>
    <div>
      <div>
        <script src="/javascripts/dash.all.min.js"></script>
        <div class="code">
            <!-- <video data-dashjs-player="" autoplay="" src="/output/converted_1713332119816.mpd" controls="true"></video> -->
        </div>
    </div>
    <div>
        <!-- <video data-dashjs-player="" autoplay="" src="https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd" controls="true"></video>
    </div>
     -->
    </div>
        </main>
     
    </div>
    
  </body>
  <script src="/javascripts/jquery-3.4.1.min.js"></script>
  <script src="/javascripts/socket.io.min.js"></script>
  <style>
  .progressContainer{  display: block;}
  </style>
  <script>
      let socket=io();
      socket.on("conversionStarted",(jobid)=>{
          console.log(`conversion for jobid:${jobid} started`)
        //  document.getElementsByClassName("progressContainer").style.display="block";
      })
      
      socket.on("conversionProress",({jobid,progress})=>{
          console.log(`jobid: ${jobid}, progress: ${progress}`)
          document.getElementById("progressbar").innerHTML=progress+"%";
          document.getElementById("progressbar").style.width=parseFloat(progress).toFixed(2)+"%";
         
      })
      socket.on("conversionfinished",({progress,dowloadurl})=>{
          document.getElementById("progressbar").style.width="100%";
          document.getElementById("progressbar").innerHTML="100%";
          document.getElementById("dowloadurl").href=dowloadurl;
          document.getElementById("dowloadurl").style.display="block";
      })
     
      document.getElementById("uploadForm").addEventListener("submit",(e)=>{
          e.preventDefault();
          const formData=new FormData(e.target);
          const videoFile = document.getElementById("videoFile").files.length;
          const NomVideoOutput = document.getElementById("NomVideoOutput").value;
         
          console.log(videoFile);
          if(videoFile== 0) { document.getElementById("message").innerHTML="Select File";
          return;}
          if(NomVideoOutput== "" ) { document.getElementById("message").innerHTML="Case Nom De Sortie  Vide";
          return;}
        
          fetch("convert",{
              method:"post",
              body:formData
          })
     .then((response)=>response.json()).then((data)=>console.log(data))
  
      })
  function clearall(){
          document.getElementById("progressbar").style.width="0%";
          document.getElementById("dowloadurl").href="";
          document.getElementById("dowloadurl").style.display="none";
         }
  function clearMSG(){
          document.getElementById("message").innerHTML="";
     }

   $("#dffg").css("color")    
  </script>
 

  </html>